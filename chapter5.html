<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Segmentation | Fundamentals of Sports Business Analytics and Strategy</title>
<meta name="author" content="Justin Watkins">
<meta name="description" content="Appropriately segmenting your data is difficult. Very difficult. While it is usually trivial to find patterns in business data, these patterns may not be useful. Often times your patterns may only...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="Chapter 5 Segmentation | Fundamentals of Sports Business Analytics and Strategy">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/book_cover.png">
<meta property="og:description" content="Appropriately segmenting your data is difficult. Very difficult. While it is usually trivial to find patterns in business data, these patterns may not be useful. Often times your patterns may only...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Segmentation | Fundamentals of Sports Business Analytics and Strategy">
<meta name="twitter:description" content="Appropriately segmenting your data is difficult. Very difficult. While it is usually trivial to find patterns in business data, these patterns may not be useful. Often times your patterns may only...">
<meta name="twitter:image" content="/images/book_cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Prompt-0.4.4/font.css" rel="stylesheet">
<link href="libs/JetBrains_Mono-0.4.4/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentals of Sports Business Analytics and Strategy</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Abstract and forward</a></li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Analytics and sports business strategy</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Constructing our data sets</a></li>
<li><a class="" href="chapter3.html"><span class="header-section-number">3</span> Exploring your data</a></li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Structuring analytics projects</a></li>
<li><a class="active" href="chapter5.html"><span class="header-section-number">5</span> Segmentation</a></li>
<li><a class="" href="chapter6.html"><span class="header-section-number">6</span> Forcasting Sales and Setting Prices</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Lead Scoring</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Marketing promotions</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> Consumer Research</a></li>
<li><a class="" href="chapter10.html"><span class="header-section-number">10</span> Operations and Analytics</a></li>
<li><a class="" href="Chapter11.html"><span class="header-section-number">11</span> Epilogue</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/Justin-Watkins/FOSBAAS_web.git">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter5" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Segmentation<a class="anchor" aria-label="anchor" href="#chapter5"><i class="fas fa-link"></i></a>
</h1>
<p>Appropriately segmenting your data is difficult. Very difficult. While it is usually trivial to find patterns in business data, these patterns may not be useful. Often times your patterns may only represent market structure and not an exploitable feature. Additionally, it is very unlikely that you will have access to the rich data that massive data platforms such as Facebook, Google, or even your league will have. This means that you will be limited in some respects. Without partnerships you can’t even approach the concept of developing insight from data in the same way as many other companies. We’ll cover a few concepts in this chapter and it has two parts:</p>
<ol style="list-style-type: decimal">
<li>Preparing the data for analysis</li>
<li>Analyzing and interpreting the data</li>
</ol>
<p>This is the spot where the book shifts to tacit examples. We are going to walk through fairly complete examples that include all the code necessary, explanations for output, and interpretation for deployment. We’ll cover a few techniques in this chapter based on our simulated data from chapter <a href="chapter2.html#chapter2">2</a>. There are several things to consider when starting a project like segmenting a data set. You’ll want to ask yourself some questions:</p>
<ol style="list-style-type: decimal">
<li>What am I trying to accomplish?</li>
<li>How will the output be consumed?</li>
<li>Who will consume it?</li>
<li>What is the incremental value of this project?</li>
</ol>
<p>Number four is important because you have limited time. Is there another area where you should be focusing? Segmentation may leverage many different machine-learning techniques. This chapter will cover a few of the techniques that we have found the most useful. Keep in mind, that you aren’t guaranteed to find anything useful. Why not? There could be any reasons:</p>
<ol style="list-style-type: decimal">
<li>Your data is bad</li>
<li>You don’t have enough data</li>
<li>Your technique is inappropriate</li>
<li>You framed the problem incorrectly</li>
<li>There isn’t anything there</li>
</ol>
<p>If you are working as a consultant, you are going to find something. You have to find something. If you are working at the club I would keep this simple sentence in mind:</p>
<blockquote>
<p>The worst thing that can happen with a data-science project is that you think you found something and deploy a solution that isn’t valid.</p>
</blockquote>
<p>In that case you may be actively harming your organization, but you are also reducing the credibility of analytics. It’s OK if you can’t find something. First, do no harm. Scale can also be a problem. How much do you think the incremental value of your work is worth? Are models built around some sort of consumer behavior going to maximize your ticket revenue potential?</p>
<p>This chapter will cover building a segmentation scheme from raw data. These projects can become complex. We’ll also look at a few different ways of accomplishing your goal. Perhaps you just need a simple way to differentiate between two groups. Maybe you need full-scale psychographic profiles. We’ll cover the basics on how some of these products are delivered. You’ll come away understanding the root of how a segmentation scheme is produced in practice. While we only cover a portion of the variety, you’ll be able to identify how a consultant would put together one of these frameworks and build your own.</p>
<div id="building-a-segmentation-scheme" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Building a segmentation scheme<a class="anchor" aria-label="anchor" href="#building-a-segmentation-scheme"><i class="fas fa-link"></i></a>
</h2>
<p>Our example is going to be based on demographic data and qualitative data taken from a survey. Our goal is to leverage a simple scheme that does a reasonable job of explaining who purchases tickets and why they purchase them. While our groups are based on demographics (for discoverability), we are actually looking for exploitable differences in behavior. For this project to be successful, we need to follow four rules:</p>
<ol style="list-style-type: decimal">
<li>Understand the difference between <strong>segments</strong> and <strong>market structure</strong>. Groups that do not differ in behavior may not be segments.</li>
<li>We must be able to distinguish segments and appeal to them selectively through product or channel.</li>
<li>Validating these segments will require constant experimentation. We are going to have to be willing and capable of experimenting on this data.</li>
<li>Sales and Marketing leadership must support and remain involved with segmentation.</li>
</ol>
<p>Sometimes segmentation schemes can be too diffuse. For instance people-with-nipples. That covers a pretty large swath of humans. Other segmentation schemes can be irrelevant to the problem. If you are selling dog-food, women with red hair may not be a relevant segment. They can also be too diffuse and irrelevant. An example here might be people with brown eyes.</p>
<p>Our basic <em>goal</em> is to find groups of fans and potential customers that differ in observable ways associated with how we communicate, their content preference, and marketing response. Generally, we are looking for an answer to the question: <strong>Who is our consumer and what do they want?</strong>. By understanding these differences, we hope to make better strategic marketing decisions regarding pricing, market positioning,
sales and sponsorship opportunities, and brand development. The analysis has two components:</p>
<ul>
<li>A <strong>demographic segmentation</strong> derived from data collected from a third party.</li>
<li>A set of <strong>behavioral archetypes</strong> derived from survey responses.</li>
</ul>
<p>Our demographic segments are overlaid on our customer’s behavioral archetypes to paint a picture of how each demographic broadly behaves. The more segments that we have, the more specific they will be. Abstracting to fewer segments means that the edges of our segments will tend to be <em>fuzzy</em>. Additionally, the durability of our segments will have to be tested to ensure validity.</p>
<p>A segmentation project is successful if you are able to increase the probability of making correct decisions. It isn’t a magic bullet, and will not answer questions with certainty. For a sports club there are special considerations.</p>
<ul>
<li>You don’t have unlimited scale potential</li>
<li>Your sample sizes are going to be relatively small</li>
</ul>
<p>You can’t continuously deploy tests in the way TicTok does. These projects tend to be ad hoc in nature. I believe they are more useful for marketers to help understand market structure within the fan base. It allows for small tweaks that help compound the effectiveness of multiple concurrent campaigns.</p>
<p>Ultimately, success should be judged on the basis of creating testable hypotheses and using this information to alter the behavior of one or more of our segments. We could also define success more narrowly:</p>
<ul>
<li>Did we create the capability to accurately measure some <em>return on marketing spend</em>?</li>
<li>Were we able to increase sales revenue by increasing <em>conversion rates</em>?</li>
<li>Are we able to better determine <em>product offerings</em>?</li>
</ul>
<p>Regardless of how we define success, segmentation should always be considered a work in progress. Segmentation cannot remain static and be successful. To maximize our opportunity, we must understand how to change our behavior to best suit our customers expectations, channel capability, and purchase behavior.</p>
</div>
<div id="demographic-segmentation" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Demographic segmentation<a class="anchor" aria-label="anchor" href="#demographic-segmentation"><i class="fas fa-link"></i></a>
</h2>
<p>Demographic segmentation is attractive for many reasons. However, discoverability is the main reason. While it can be useful in certain circumstances, its use is also fraught with peril. Steve Koonin (CEO of the Atlanta Hawks) famously stated the Alpharetta Unicorn couldn’t save the franchise (referring to the Atlanta Hawks). The “Alpharetta Unicorn” is:</p>
<blockquote>
<p><strong>“the 55-year-old guy who’s going to drive an hour from Alpharetta into the city with three buddies to go to the Hawks game. He doesn’t exist. And there is no music, no kiss cam, no cheerleaders, no shooting for a free car, no bobbleheads … nothing is going to change that.”</strong></p>
<p>— Steve Koonin</p>
</blockquote>
<p>Alpharetta is a suburb of Atlanta that contrasts with much of Fulton County GA in that its citizens (as of 2021) tend to be less ethnically diverse (mostly white), more right-leaning politically (mostly Republican), and tend to be more homogeneously affluent. Being an outlying suburb, it is also geographically isolated.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.espn.com/nba/story/_/id/12080830/reselling-hawks-atlanta" class="uri"&gt;https://www.espn.com/nba/story/_/id/12080830/reselling-hawks-atlanta&lt;/a&gt;&lt;/p&gt;'><sup>33</sup></a> Steve’s response is loaded for several reasons. He is actually saying that the Hawks brand is not congruent with their marketing tactics. He may have also been taking a shot at another in-market team. Either way, his <em>segment</em> may or may not exist. Perhaps it is just irrelevant to his specific situation and this statement is a political stunt to justify the direction he decided to take sales and marketing.</p>
<p>Let’s begin by taking a look at a relatively simple data set. You will undoubtedly be confronted with data that is much more complex during your career, but in the context of sports your data will likely be fairly straightforward and simple. Our data sample can be found in the FOSBAAS package and is entitled <em>demographic_data</em>.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Read data to use for segmentation</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Justin-Watkins/FOSBAAS">FOSBAAS</a></span><span class="op">)</span></span>
<span><span class="va">demo_data</span>  <span class="op">&lt;-</span> <span class="fu">FOSBAAS</span><span class="fu">::</span><span class="va">demographic_data</span></span></code></pre></div>
<p>Let’s begin by taking a look at the column names.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Take a look at the structure of the data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:segdatasetnames2">Table 5.1: </span>structure of demographic data set</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">classe</th>
<th align="left">first_values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">custID</td>
<td align="left">character</td>
<td align="left">MBT9G0X70NTI, QTR3JJJ5J6GJ</td>
</tr>
<tr class="even">
<td align="left">nameF</td>
<td align="left">character</td>
<td align="left">Philip, Evelyn</td>
</tr>
<tr class="odd">
<td align="left">nameL</td>
<td align="left">character</td>
<td align="left">Riddle, Campos</td>
</tr>
<tr class="even">
<td align="left">nameFull</td>
<td align="left">character</td>
<td align="left">Philip Riddle, Evelyn Campos</td>
</tr>
<tr class="odd">
<td align="left">gender</td>
<td align="left">character</td>
<td align="left">m, f</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="left">double</td>
<td align="left">55, 30</td>
</tr>
<tr class="odd">
<td align="left">latitude</td>
<td align="left">double</td>
<td align="left">36.0491208455478, 37.1248221175549</td>
</tr>
<tr class="even">
<td align="left">longitude</td>
<td align="left">double</td>
<td align="left">-86.0860894506936, -86.0744325353366</td>
</tr>
<tr class="odd">
<td align="left">distance</td>
<td align="left">double</td>
<td align="left">48.34, 77.09</td>
</tr>
<tr class="even">
<td align="left">maritalStatus</td>
<td align="left">character</td>
<td align="left">m, s</td>
</tr>
<tr class="odd">
<td align="left">ethnicity</td>
<td align="left">character</td>
<td align="left">w, w</td>
</tr>
<tr class="even">
<td align="left">children</td>
<td align="left">character</td>
<td align="left">y, n</td>
</tr>
<tr class="odd">
<td align="left">hhIncome</td>
<td align="left">double</td>
<td align="left">2866, 552</td>
</tr>
</tbody>
</table></div>
<p>This table has 200,000 rows and 12 columns corresponding to standard demographic features. Latitude and longitude have already been processed into a distance metric. We’ll pare this data down to the information that we think might be useful for processing.</p>
<div id="exploring-the-demographic-data-set" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Exploring the demographic data set<a class="anchor" aria-label="anchor" href="#exploring-the-demographic-data-set"><i class="fas fa-link"></i></a>
</h3>
<p>We can sample the variables that we think might be useful for segmentation using the <em>select</em> function from <em>dplyr</em>.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># subset the data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">demo_data</span> <span class="op">&lt;-</span> <span class="va">demo_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">custID</span>,<span class="va">ethnicity</span>,<span class="va">age</span>,</span>
<span>                                  <span class="va">maritalStatus</span>,<span class="va">children</span>,</span>
<span>                                  <span class="va">hhIncome</span>,<span class="va">distance</span>,<span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<p>Taking a look at the first few lines of data we can see that we have a mixture of discrete data such as ethnicity and continuous data such as age. This is relevant to how you will process the data and which algorithm you might choose to deploy.</p>
<div class="inline-table"><table class="table table-sm">
<caption>(#tab:seg_dataset_str2)Demograhic data</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">classe</th>
<th align="left">first_values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">custID</td>
<td align="left">character</td>
<td align="left">MBT9G0X70NTI, QTR3JJJ5J6GJ</td>
</tr>
<tr class="even">
<td align="left">ethnicity</td>
<td align="left">character</td>
<td align="left">w, w</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="left">double</td>
<td align="left">55, 30</td>
</tr>
<tr class="even">
<td align="left">maritalStatus</td>
<td align="left">character</td>
<td align="left">m, s</td>
</tr>
<tr class="odd">
<td align="left">children</td>
<td align="left">character</td>
<td align="left">y, n</td>
</tr>
<tr class="even">
<td align="left">hhIncome</td>
<td align="left">double</td>
<td align="left">2866, 552</td>
</tr>
<tr class="odd">
<td align="left">distance</td>
<td align="left">double</td>
<td align="left">48.34, 77.09</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="left">character</td>
<td align="left">m, f</td>
</tr>
</tbody>
</table></div>
<p><em>hhIncome</em> is a modeled indicator. It is common to run into this type of variable with purchased data sets. It is indexed at some value and has a discrete beginning and end. You’d need a data dictionary to explain what the numbers actually mean. In this case, the larger the number, the higher the income. Let’s start by taking a look at our numerical data sets. We’ll use the same graphics paradigm that we illustrated in chapter <a href="chapter3.html#chapter3">3</a>.</p>
<div id="age-of-our-customers" class="section level4" number="5.2.1.1">
<h4>
<span class="header-section-number">5.2.1.1</span> Age of our customers<a class="anchor" aria-label="anchor" href="#age-of-our-customers"><i class="fas fa-link"></i></a>
</h4>
<p>We’ll begin with some exploratory data analysis. Let’s build a histogram with the categorical variable <em>gender</em> to differentiate between the two groups.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Histogram of the age of fans</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">x_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'\n Age'</span><span class="op">)</span></span>
<span><span class="va">y_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Count \n'</span><span class="op">)</span></span>
<span><span class="va">title</span>    <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Distribution of age (demographic)'</span><span class="op">)</span></span>
<span><span class="va">hist_age</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">demo_data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age</span>,fill<span class="op">=</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>                            <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette</span><span class="op">)</span>                     <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'coral'</span><span class="op">)</span>                               <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>               <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>               <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">x_label</span><span class="op">)</span>                                           <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">y_label</span><span class="op">)</span>                                           <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>                                          <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_age_histogram.png" width="100%"></div>
<p>This distribution is clearly bimodal<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;A distribution with two or more modes: multimodal&lt;/p&gt;"><sup>34</sup></a>. As we think about describing the data we already know that an average age doesn’t make much sense. We included gender to see if there were any obvious differences between men and women in the sample. Let’s take a closer look using the <em>describe</em> function from the psych package<span class="citation">(<a href="references.html#ref-R-psych" role="doc-biblioref">Revelle 2021</a>)</span>.:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Get summary statistics</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://personality-project.org/r/psych/">psych</a></span><span class="op">)</span></span>
<span><span class="va">descript</span>   <span class="op">&lt;-</span> <span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/describe.html">describe</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span><span class="va">descriptMF</span> <span class="op">&lt;-</span> <span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/describe.by.html">describeBy</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">age</span>,<span class="va">demo_data</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:demographicsagedescription2a">Table 5.2: </span>Males vs. Females</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">vars</td>
<td align="left">1, NA</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="left">2e+05, NA</td>
</tr>
<tr class="odd">
<td align="left">mean</td>
<td align="left">42.80677, NA</td>
</tr>
<tr class="even">
<td align="left">sd</td>
<td align="left">12.4664561616261, NA</td>
</tr>
<tr class="odd">
<td align="left">median</td>
<td align="left">46, NA</td>
</tr>
<tr class="even">
<td align="left">trimmed</td>
<td align="left">42.89526875, NA</td>
</tr>
<tr class="odd">
<td align="left">mad</td>
<td align="left">16.3086, NA</td>
</tr>
<tr class="even">
<td align="left">min</td>
<td align="left">13, NA</td>
</tr>
<tr class="odd">
<td align="left">max</td>
<td align="left">79, NA</td>
</tr>
<tr class="even">
<td align="left">range</td>
<td align="left">66, NA</td>
</tr>
<tr class="odd">
<td align="left">skew</td>
<td align="left">-0.131120256604631, NA</td>
</tr>
<tr class="even">
<td align="left">kurtosis</td>
<td align="left">-1.34730877799027, NA</td>
</tr>
<tr class="odd">
<td align="left">se</td>
<td align="left">0.0278758434159171, NA</td>
</tr>
</tbody>
</table></div>
<p>We can tell that the distribution skews older (mean 42.82 vs. median 46). Let’s also take a look to see if there are any significant differences between the women in the sample.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:demographicsagedescription2aby">Table 5.3: </span>Descriptive statistics</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">female</th>
<th align="left">male</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">f.vars</td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">f.n</td>
<td align="left">99925</td>
<td align="left">100075</td>
</tr>
<tr class="odd">
<td align="left">f.mean</td>
<td align="left">42.7977082812109</td>
<td align="left">42.8158181363977</td>
</tr>
<tr class="even">
<td align="left">f.sd</td>
<td align="left">12.4716960187927</td>
<td align="left">12.4612776974085</td>
</tr>
<tr class="odd">
<td align="left">f.median</td>
<td align="left">46</td>
<td align="left">46</td>
</tr>
<tr class="even">
<td align="left">f.trimmed</td>
<td align="left">42.8875170438198</td>
<td align="left">42.9029864728145</td>
</tr>
<tr class="odd">
<td align="left">f.mad</td>
<td align="left">16.3086</td>
<td align="left">16.3086</td>
</tr>
<tr class="even">
<td align="left">f.min</td>
<td align="left">13</td>
<td align="left">13</td>
</tr>
<tr class="odd">
<td align="left">f.max</td>
<td align="left">79</td>
<td align="left">76</td>
</tr>
<tr class="even">
<td align="left">f.range</td>
<td align="left">66</td>
<td align="left">63</td>
</tr>
<tr class="odd">
<td align="left">f.skew</td>
<td align="left">-0.129498978758542</td>
<td align="left">-0.132737695388044</td>
</tr>
<tr class="even">
<td align="left">f.kurtosis</td>
<td align="left">-1.35002276019439</td>
<td align="left">-1.34461956820989</td>
</tr>
<tr class="odd">
<td align="left">f.se</td>
<td align="left">0.0394537636411379</td>
<td align="left">0.0393912511291551</td>
</tr>
</tbody>
</table></div>
<p>As we can see, the numbers are almost identical. Men and women tend to be about the same age.</p>
</div>
<div id="distance-from-facility" class="section level4" number="5.2.1.2">
<h4>
<span class="header-section-number">5.2.1.2</span> Distance from facility<a class="anchor" aria-label="anchor" href="#distance-from-facility"><i class="fas fa-link"></i></a>
</h4>
<p>Distance is another interesting numerical data set. Distance could be especially important depending on how we are thinking about our product. Who is more likely to purchase a season ticket? Someone that is five miles from the venue or five hundred? The answer is that it depends, but as a general rule, season ticket holders tend to live closer to venues.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Distance from our facility</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">x_label</span>   <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'\n Distance'</span><span class="op">)</span></span>
<span><span class="va">y_label</span>   <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Count \n'</span><span class="op">)</span></span>
<span><span class="va">title</span>     <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Distribution of distance (demographic)'</span><span class="op">)</span></span>
<span><span class="va">hist_dist</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">demo_data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span>            <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>,fill<span class="op">=</span><span class="st">'dodgerblue'</span><span class="op">)</span>             <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'coral'</span><span class="op">)</span>                                  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>                  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>                  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">x_label</span><span class="op">)</span>                                              <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">y_label</span><span class="op">)</span>                                              <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>                                             <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_distance_histogram.png" width="100%"></div>
<p>This distribution is also bimodal. Can we speculate as to why? Perhaps the sample has more season ticket holders as a percentage of the group. Perhaps there is another major city around two-hundred miles away? Patterns like this show up when you are looking at tickets sales. It is simply easier for people close-by to purchase tickets. You could never imagine a ballpark or stadium being placed in a rural area. Distance is simply going to be a significant variable in models. Be careful of how you treat it. Are you measuring the distance for purchasers? Each individual ticket? Are you differentiating between fans and companies?</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Use the psych package to generate summary statistics</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">descript</span> <span class="op">&lt;-</span> <span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/describe.html">describe</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span></span></code></pre></div>
<p>Taking a look at the data we can see the skew in the numbers. The median distance is 66.47 miles and the mean distance is over 110 miles. These sorts of datasets can be problematic for regression, but may work in our favor in terms of identifying market structure. It can also be useful for thinking about different marketing tactics such as OOH<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Out of Home. Think signage&lt;/p&gt;"><sup>35</sup></a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:demographicsdistancedescriptiona">Table 5.4: </span>Descriptive statistics distance</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">calues</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">vars</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="left">2e+05</td>
</tr>
<tr class="odd">
<td align="left">mean</td>
<td align="left">110.1194244</td>
</tr>
<tr class="even">
<td align="left">sd</td>
<td align="left">92.1463189574666</td>
</tr>
<tr class="odd">
<td align="left">median</td>
<td align="left">66.47</td>
</tr>
<tr class="even">
<td align="left">trimmed</td>
<td align="left">99.381923375</td>
</tr>
<tr class="odd">
<td align="left">mad</td>
<td align="left">67.08765</td>
</tr>
<tr class="even">
<td align="left">min</td>
<td align="left">0.05</td>
</tr>
<tr class="odd">
<td align="left">max</td>
<td align="left">543.23</td>
</tr>
<tr class="even">
<td align="left">range</td>
<td align="left">543.18</td>
</tr>
<tr class="odd">
<td align="left">skew</td>
<td align="left">0.895830211498572</td>
</tr>
<tr class="even">
<td align="left">kurtosis</td>
<td align="left">-0.0936393439147278</td>
</tr>
<tr class="odd">
<td align="left">se</td>
<td align="left">0.206045433065273</td>
</tr>
</tbody>
</table></div>
<p>The distribution of distance is much different than age. The median is significantly smaller than the mean which indicates a left skew to the distribution.</p>
</div>
<div id="household-income" class="section level4" number="5.2.1.3">
<h4>
<span class="header-section-number">5.2.1.3</span> Household income<a class="anchor" aria-label="anchor" href="#household-income"><i class="fas fa-link"></i></a>
</h4>
<p>Household income is another continuous data set. It is also modeled, which means it is likely scaled in some fashion. This distribution is multimodal with several peaks.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Histogram of income</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">x_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'\n Household Income'</span><span class="op">)</span></span>
<span><span class="va">y_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Count \n'</span><span class="op">)</span></span>
<span><span class="va">title</span>    <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Distribution of Income (demographic)'</span><span class="op">)</span></span>
<span><span class="va">hist_income</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">demo_data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">hhIncome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>,fill<span class="op">=</span><span class="st">'dodgerblue'</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'coral'</span><span class="op">)</span>                       <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>       <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>       <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">x_label</span><span class="op">)</span>                                   <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">y_label</span><span class="op">)</span>                                   <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>                                  <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_income_histogram.png" width="100%"></div>
<p>This is where some analysis is important. Ultimately, we are looking for differences in behavior that we can attribute to different features related to a discoverable group of individuals. We’ll touch on this when we begin to process the data for quantitative analysis. We don’t currently have a reason to believe that there is any difference between how a person behaves based on income. However, we can probably make some guesses that may or may not have merit in relation to our data.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># summary statistics of hhincome</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">description</span> <span class="op">&lt;-</span> <span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/describe.html">describe</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">hhIncome</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:demographicsincomedescriptionA">Table 5.5: </span>Descriptive statistics income</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">calues</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">vars</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="left">2e+05</td>
</tr>
<tr class="odd">
<td align="left">mean</td>
<td align="left">2020.089345</td>
</tr>
<tr class="even">
<td align="left">sd</td>
<td align="left">925.696888455458</td>
</tr>
<tr class="odd">
<td align="left">median</td>
<td align="left">2153</td>
</tr>
<tr class="even">
<td align="left">trimmed</td>
<td align="left">2046.65716875</td>
</tr>
<tr class="odd">
<td align="left">mad</td>
<td align="left">1125.2934</td>
</tr>
<tr class="even">
<td align="left">min</td>
<td align="left">279</td>
</tr>
<tr class="odd">
<td align="left">max</td>
<td align="left">4245</td>
</tr>
<tr class="even">
<td align="left">range</td>
<td align="left">3966</td>
</tr>
<tr class="odd">
<td align="left">skew</td>
<td align="left">-0.217211029101283</td>
</tr>
<tr class="even">
<td align="left">kurtosis</td>
<td align="left">-1.20496002863362</td>
</tr>
<tr class="odd">
<td align="left">se</td>
<td align="left">2.06992116914645</td>
</tr>
</tbody>
</table></div>
<p>There are clearly clusters of groups in this data. Think critically about this one. Does a higher household income mean more disposable income? In some cases yes, but in some cases, no. Are there any implicit signs of disposable income that we could use? Perhaps luxury cars or pool ownership. Up to a point, people may tend to spend most of their income. If someone makes more money they tend to buy nicer cars or bigger houses. While asset investments such as houses may increase wealth, they may not indicate more disposable income.</p>
</div>
<div id="consololidating-the-numerical-analysis" class="section level4" number="5.2.1.4">
<h4>
<span class="header-section-number">5.2.1.4</span> Consololidating the numerical analysis<a class="anchor" aria-label="anchor" href="#consololidating-the-numerical-analysis"><i class="fas fa-link"></i></a>
</h4>
<p>You can get all of these numbers at once with a little manipulation. In this case we aren’t looking for anomalous data such as NAs or missing data.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Generate summary stats of multiple values</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">numerical_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="va">demo_data</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">description</span>    <span class="op">&lt;-</span> <span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/describe.html">describe</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">[</span><span class="va">numerical_cols</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:demographicsconsolidatedA">Table 5.6: </span>Consolidated statistics</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">age</th>
<th align="left">income</th>
<th align="left">distance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">vars</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="left">2e+05</td>
<td align="left">2e+05</td>
<td align="left">2e+05</td>
</tr>
<tr class="odd">
<td align="left">mean</td>
<td align="left">42.80677</td>
<td align="left">2020.089345</td>
<td align="left">110.1194244</td>
</tr>
<tr class="even">
<td align="left">sd</td>
<td align="left">12.4664561616261</td>
<td align="left">925.696888455458</td>
<td align="left">92.1463189574666</td>
</tr>
<tr class="odd">
<td align="left">median</td>
<td align="left">46</td>
<td align="left">2153</td>
<td align="left">66.47</td>
</tr>
<tr class="even">
<td align="left">trimmed</td>
<td align="left">42.89526875</td>
<td align="left">2046.65716875</td>
<td align="left">99.381923375</td>
</tr>
<tr class="odd">
<td align="left">mad</td>
<td align="left">16.3086</td>
<td align="left">1125.2934</td>
<td align="left">67.08765</td>
</tr>
<tr class="even">
<td align="left">min</td>
<td align="left">13</td>
<td align="left">279</td>
<td align="left">0.05</td>
</tr>
<tr class="odd">
<td align="left">max</td>
<td align="left">79</td>
<td align="left">4245</td>
<td align="left">543.23</td>
</tr>
<tr class="even">
<td align="left">range</td>
<td align="left">66</td>
<td align="left">3966</td>
<td align="left">543.18</td>
</tr>
<tr class="odd">
<td align="left">skew</td>
<td align="left">-0.131120256604631</td>
<td align="left">-0.217211029101283</td>
<td align="left">0.895830211498572</td>
</tr>
<tr class="even">
<td align="left">kurtosis</td>
<td align="left">-1.34730877799027</td>
<td align="left">-1.20496002863362</td>
<td align="left">-0.0936393439147278</td>
</tr>
<tr class="odd">
<td align="left">se</td>
<td align="left">0.0278758434159171</td>
<td align="left">2.06992116914645</td>
<td align="left">0.206045433065273</td>
</tr>
</tbody>
</table></div>
<p>As a best practice, don’t do things multiple times. If you can think of a way that you would like to view your data, somebody else has probably thought about it and solved the problem.</p>
</div>
<div id="categorical-variables" class="section level4" number="5.2.1.5">
<h4>
<span class="header-section-number">5.2.1.5</span> Categorical variables<a class="anchor" aria-label="anchor" href="#categorical-variables"><i class="fas fa-link"></i></a>
</h4>
<p>There are myriad ways to analyze categorical data. We’ll go through a few methods and describe what we are seeing. We can create a proportion table with the <em>prop.table</em> function to take a look at how large our discrete groups are.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># build proportion table for categorical data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">description</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">ethnicity</span><span class="op">)</span></span>
<span><span class="va">description_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="va">description</span><span class="op">)</span></span></code></pre></div>
<p>In this case, white fans represent about 80% of our sample, African Americans represent about 10%, with Hispanics and Asians representing another 10%.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:demographicsethnicitya">Table 5.7: </span>Ethnicity proportions</caption>
<thead><tr class="header">
<th align="center">Var1</th>
<th align="center">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">a</td>
<td align="center">0.023595</td>
</tr>
<tr class="even">
<td align="center">aa</td>
<td align="center">0.104025</td>
</tr>
<tr class="odd">
<td align="center">h</td>
<td align="center">0.071325</td>
</tr>
<tr class="even">
<td align="center">w</td>
<td align="center">0.801055</td>
</tr>
</tbody>
</table></div>
<p>Analyzing ethnicity is fraught with difficulty. What does it mean? How do you identify and differentiate Hispanics? It seems nonsensical. Folks can <em>get wrapped-around-the-axle</em> here. Sponsors, the media, internal HR staffs, local governments, everyone gets concerned about ethnicity and what it means or doesn’t mean in terms of attendance. It is a loaded word. The analyst can make it worse. Let’s consider a joke I heard. I don’t know who to attribute it to:</p>
<blockquote>
<p>An algorithm walks into a bar and the bartender says “what will you have?” The algorithm looks around and says “I’ll have what everyone else is having.”</p>
</blockquote>
<p>You are likely going to find exactly what you expect to find here. So, why does ethnicity matter. Perhaps it doesn’t as a point estimate. Longitudinally you can think of applications. Is it meaningful that ticket buyers tend to live nearby and most of the ticket buyers identify with a certain ethnicity? What does this mean in five or ten years as an area grows?</p>
<p>It is also typically useful to look at crosstabs of the data. Let’s compare African Americans to white fans.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># use describeBy to generate statistics tabulated by a factor</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">numerical_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="va">demo_data</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">description</span>    <span class="op">&lt;-</span> <span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/describe.by.html">describeBy</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">[</span><span class="va">numerical_cols</span><span class="op">]</span>, </span>
<span>                                    <span class="va">demo_data</span><span class="op">$</span><span class="va">ethnicity</span><span class="op">)</span></span>
<span><span class="va">deth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">description</span><span class="op">$</span><span class="va">aa</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>, </span>
<span>              <span class="va">description</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:demographicsethnicityC">Table 5.8: </span>Ethnicity proportions</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">n</th>
<th align="center">mean</th>
<th align="center">sd</th>
<th align="center">median</th>
<th align="center">trimmed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="center">20805</td>
<td align="center">44.39976</td>
<td align="center">12.12386</td>
<td align="center">48.00</td>
<td align="center">44.78114</td>
</tr>
<tr class="even">
<td align="left">hhIncome</td>
<td align="center">20805</td>
<td align="center">2088.84581</td>
<td align="center">915.51600</td>
<td align="center">2279.00</td>
<td align="center">2129.14028</td>
</tr>
<tr class="odd">
<td align="left">distance</td>
<td align="center">20805</td>
<td align="center">118.66955</td>
<td align="center">91.97917</td>
<td align="center">77.62</td>
<td align="center">109.10382</td>
</tr>
<tr class="even">
<td align="left">age1</td>
<td align="center">160211</td>
<td align="center">42.60530</td>
<td align="center">12.50088</td>
<td align="center">46.00</td>
<td align="center">42.65204</td>
</tr>
<tr class="odd">
<td align="left">hhIncome1</td>
<td align="center">160211</td>
<td align="center">2011.05849</td>
<td align="center">926.59481</td>
<td align="center">2135.00</td>
<td align="center">2035.75179</td>
</tr>
<tr class="even">
<td align="left">distance1</td>
<td align="center">160211</td>
<td align="center">109.14702</td>
<td align="center">92.14637</td>
<td align="center">65.32</td>
<td align="center">98.26498</td>
</tr>
</tbody>
</table></div>
<p>When comparing these groups we can see that most numbers are fairly close. We can also make some generalizations.</p>
<ol style="list-style-type: decimal">
<li>Many more of our fans tend to be white. Is this congruent with population patterns?</li>
<li>Wealth factors seem to be similar</li>
<li>Whites tend to be slightly younger and live closer to the park</li>
</ol>
<p>We can leverage this sort of analysis to see if we are over or under-indexing within some populations (assuming that has any merit). Do these factors explain purchases? Now that we have done some cursory analysis of the data we can begin processing it for modeling. Never overlook analyzing each factor in your data set individually. Getting an understanding of the data structure could be extremely useful as you work through the rest of your analysis.</p>
</div>
</div>
<div id="preparing-the-data-for-modeling" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Preparing the data for modeling<a class="anchor" aria-label="anchor" href="#preparing-the-data-for-modeling"><i class="fas fa-link"></i></a>
</h3>
<p>Unfortunately, you’ll spend a lot of time prepping data so that you can operate on it. We’ll talk about some of the major problems you will face and what you can do about them. There are several that you will be confronted with frequently:</p>
<ul>
<li>Missing data (NA,NAN,Inf)</li>
<li>Sparse data</li>
</ul>
<p>We’ll briefly touch on imputation and give some thoughts as to when it’s appropriate to use. This is an enormous subject that is far outside of the scope of this book.</p>
</div>
<div id="dealing-with-missing-data" class="section level3" number="5.2.3">
<h3>
<span class="header-section-number">5.2.3</span> Dealing with missing data<a class="anchor" aria-label="anchor" href="#dealing-with-missing-data"><i class="fas fa-link"></i></a>
</h3>
<p>Missing data is almost always a problem and there are a few different ways in which it can be handled. One consideration is why the data is missing. The reasons why data is missing can bias the results of your analysis. This is a frequent problem with surveys. For instance, perhaps the survey is long and people only tend to finish a portion of it. This data is “not missing completely at random.” This is a technical term and while there are ways to deal with it, we don’t have to worry about it here. Just be aware of these issues.</p>
<p>Imputing data (dealing with missing data) can be an extremely complex task. First, you need to understand how much of your data is missing. There are several packages that deal with missing data. You can also write a simple function to help you identify the common culprits. Let’s take a look at our data to see if it is missing anything.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Write a function to generate stats on missing data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">f_missing_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dF</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="va">na</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">dF</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">dF</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.nan</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">dF</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.infinite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">missing</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">na</span>,<span class="va">nan</span>,<span class="va">inf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">missing</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'Values'</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">missing</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">missing</span> <span class="op">&lt;-</span> <span class="fu">f_missing_data</span><span class="op">(</span><span class="va">demo_data</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:missingdatab">Table 5.9: </span>Missing values</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">Values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">na</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">nan</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">inf</td>
<td align="center">0</td>
</tr>
</tbody>
</table></div>
<p>Nothing is missing! That isn’t surprising since I created this data set. Let’s introduce some missing data so that we can explore this important subject. We will randomly assign cells to NA based on a random number generated for each cell in the dataframe.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Randomly make some values in dataframe NA</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">755</span><span class="op">)</span></span>
<span><span class="va">demo_data</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">demo_data</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">.98</span>,<span class="cn">NA</span>,<span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This function randomly makes 2% of fields NA.</p>
<p>Now we can apply our simple function to determine if there are missing values. It looks like we were successful.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:missingdatae">Table 5.10: </span>New missing values</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">Values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">na</td>
<td align="center">32211</td>
</tr>
<tr class="even">
<td align="left">nan</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">inf</td>
<td align="center">0</td>
</tr>
</tbody>
</table></div>
<p>Now we need to do something about these missing values. If only a small amount of data is missing it may be OK to simply delete the rows. How much is a small amount? I don’t know. Let’s look at this by rows to determine which rows have missing values. We’ll use a simple <em>for</em> loop to count the missing fields in each row and column. There are a few different ways to do this.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Print the number of missing values for each column</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "3973 custID"</span></span>
<span><span class="co">#&gt; [1] "3997 ethnicity"</span></span>
<span><span class="co">#&gt; [1] "4042 age"</span></span>
<span><span class="co">#&gt; [1] "4111 maritalStatus"</span></span>
<span><span class="co">#&gt; [1] "4021 children"</span></span>
<span><span class="co">#&gt; [1] "3993 hhIncome"</span></span>
<span><span class="co">#&gt; [1] "4044 distance"</span></span>
<span><span class="co">#&gt; [1] "4030 gender"</span></span>
<span><span class="co"># You can get the same data with this statement:</span></span>
<span></span>
<span><span class="co"># sapply(1:length(names(demo_data)), function(x)</span></span>
<span><span class="co">#        paste(sum(is.na(demo_data[,x])),names(demo_data[x])))</span></span>
<span></span>
<span><span class="co"># A best practice is to funcionalize in R when possible</span></span></code></pre></div>
<p>It looks like about four-thousand entries are missing for each attribute. Since we know that these could overlap it may not be a great idea to simply delete all of these rows. How many rows have some missing data? We can use the complete cases function to determine how many rows are complete.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Only keep rows with no NAs in any column</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">complete_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span>,caption <span class="op">=</span> <span class="st">'Complete cases'</span>,</span>
<span>             align <span class="op">=</span> <span class="st">'c'</span>,format <span class="op">=</span> <span class="st">"markdown"</span>,padding <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:missingdatafff">Table 5.11: </span>Complete cases</caption>
<thead><tr class="header">
<th align="center">x</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">169903</td>
</tr></tbody>
</table></div>
<p>About thirty thousand rows are missing some data. That is more than enough to build a suitable model. How do we know? There are no hard and fast rules. If you sampled 10,000 rows of this data you would find that the distributions for each field would tend to look the same as the full data set. That is really what you are looking for. This will be the case until you reach some arbitrarily small number (perhaps 400-700 people). Some people call this the <em>law of large numbers</em>. This is really just an expression. There is no such law. However, this is where you might think about why the data is missing. More data is typically better, but you get penalized on process time.</p>
<p>let’s try a couple of different techniques to impute the missing data. For <em>ethnicity</em> we know that the vast majority (80%) of our known values were “w.” We can replace all NAs with a “w” and assume that we will be close to 80% accurate. This is easy to accomplish with the following code.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Simple imputation. Make any NAs 'w'</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">ethnicity</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">ethnicity</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'w'</span></span></code></pre></div>
<p>Age will be a little trickier. We know that the distribution is multi-modal. Taking the most common value might be reasonable. However, we could also simply take the mean or median. Additionally, some factors within the data set such as <em>children</em> and <em>income</em> may be useful in predicting age with some degree of accuracy. Which technique is best? We don’t know. However, this only represents about two percent of all entries. If we choose a suboptimal path, the damage will be minimal. In our case, we are going to be lazy and simply use the mean age.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Make an y missing age values the mean of overall age</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">mA</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mA</span></span></code></pre></div>
<p>using averages is interesting because if you looked at the entire data set you would find that very few know individuals are the average age. This is a known issue when designing everything from airplane cockpits to gloves. We could also simulate the distribution and randomly assign values from that distribution. However, that technique also has issues. Once again, just be aware of what you are doing and think critically about it. If you can reasonably justify an approach, it is probably good enough.</p>
<p>We know that about 58% of our fans are married. How should we approach this one? Is the pattern for marriage random? If we randomly pick one assuming that the individual is married 58% of the time will that be more accurate than simply saying everyone is married? We can’t really tell here. We could pull out Bayes’ theorem and coming up with all kinds of ways to estimate the likelihood that a person is married. Since we are only dealing with 2% of our data, we are going to go with simple imputation of random guesses with a discrete probability.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Impute values based on a proportion</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">maritalStatus</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">maritalStatus</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">maritalStatus</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">maritalStatus</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'m'</span>,<span class="st">'s'</span><span class="op">)</span>, size<span class="op">=</span><span class="va">l</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.6</span>,<span class="fl">.4</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We have now imputed three variables and can see how tedious of an exercise this can be. There are several packages that can help automate some of this task.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,caption <span class="op">=</span> <span class="st">'Customer data set'</span>,</span>
<span>             align <span class="op">=</span> <span class="st">'c'</span>,format <span class="op">=</span> <span class="st">"markdown"</span>,padding <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:missingdatagd">Table 5.12: </span>Customer data set</caption>
<thead><tr class="header">
<th align="center">custID</th>
<th align="center">ethnicity</th>
<th align="center">age</th>
<th align="center">maritalStatus</th>
<th align="center">children</th>
<th align="center">hhIncome</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">MBT9G0X70NTI</td>
<td align="center">w</td>
<td align="center">55</td>
<td align="center">m</td>
<td align="center">y</td>
<td align="center">2866</td>
</tr>
<tr class="even">
<td align="center">NA</td>
<td align="center">w</td>
<td align="center">30</td>
<td align="center">s</td>
<td align="center">n</td>
<td align="center">552</td>
</tr>
<tr class="odd">
<td align="center">HOMV3XQW32LW</td>
<td align="center">w</td>
<td align="center">30</td>
<td align="center">s</td>
<td align="center">n</td>
<td align="center">2274</td>
</tr>
<tr class="even">
<td align="center">RJ7CCATUH4Q1</td>
<td align="center">w</td>
<td align="center">29</td>
<td align="center">s</td>
<td align="center">n</td>
<td align="center">1773</td>
</tr>
<tr class="odd">
<td align="center">9GZT5Z5AOMKV</td>
<td align="center">w</td>
<td align="center">48</td>
<td align="center">m</td>
<td align="center">n</td>
<td align="center">1951</td>
</tr>
<tr class="even">
<td align="center">S0Y0Y2454IU2</td>
<td align="center">w</td>
<td align="center">49</td>
<td align="center">m</td>
<td align="center">y</td>
<td align="center">3244</td>
</tr>
</tbody>
</table></div>
<p>We can approach <em>children</em> and <em>gender</em> in much the same way as our other categorical data.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Impute remaining values based on a proportion</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co">#prop.table(table(demo_data$children))</span></span>
<span><span class="co">#prop.table(table(demo_data$gender))</span></span>
<span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">children</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">children</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">children</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">children</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'n'</span>,<span class="st">'y'</span><span class="op">)</span>, size<span class="op">=</span><span class="va">l</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.52</span>,<span class="fl">.48</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'m'</span>,<span class="st">'f'</span><span class="op">)</span>, size<span class="op">=</span><span class="va">l</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a slightly different approach to the rest of the data. For Customer Ids that are missing, we are going to delete the rows. There aren’t many, and without being able to link our segment constituents to an individual they have less utility. We want to be able to compare these demographic attributes to actual behaviors.</p>
<div id="imputating-with-a-package" class="section level5" number="5.2.3.0.1">
<h5>
<span class="header-section-number">5.2.3.0.1</span> Imputating with a package<a class="anchor" aria-label="anchor" href="#imputating-with-a-package"><i class="fas fa-link"></i></a>
</h5>
<p>There are several packages for imputing numerical data. One of the more commonly used ones is <em>mice</em> <span class="citation">(<a href="references.html#ref-R-mice" role="doc-biblioref">van Buuren and Groothuis-Oudshoorn 2021</a>)</span>. It is easy to use and works relatively quickly on smaller datasets. There are several parameters that can be adjusted in the <em>mice</em> function. See the documentation to explain what what they indicate. For instance, we used <em>predictive mean matching</em> as the method. However, there are more than a dozen options here. Some may be more appropriate than others under specific conditions.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Impute numerical values using the mice package</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice">mice</a></span><span class="op">)</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span></span>
<span><span class="va">imp_frame</span>          <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">hhIncome</span>,</span>
<span>                           <span class="va">demo_data</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imp_frame</span><span class="op">[</span><span class="op">]</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">imp_frame</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">imputed_Data</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html">mice</a></span><span class="op">(</span><span class="va">imp_frame</span>, m<span class="op">=</span><span class="fl">5</span>, maxit <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                           method <span class="op">=</span> <span class="st">'pmm'</span>, seed <span class="op">=</span> <span class="fl">755</span>,</span>
<span>                           printFlag <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">new_Data</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">imputed_Data</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">hhIncome</span> <span class="op">&lt;-</span> <span class="va">new_Data</span><span class="op">$</span><span class="va">V1</span></span>
<span><span class="va">demo_data</span><span class="op">$</span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="va">new_Data</span><span class="op">$</span><span class="va">V2</span></span></code></pre></div>
<p>Let’s go ahead and delete rows where the customerid is missing. Use <em>na.omit</em> to greedily remove all rows where any column is NA. You can be more subtle, but in this case <em>na.omit</em> will get the job done.</p>
<p>Now we can run our function to look for missing values one more time.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:missingdatalasta">Table 5.13: </span>New missing values</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">Values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">na</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">nan</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">inf</td>
<td align="center">0</td>
</tr>
</tbody>
</table></div>
<p>Perfect. While you are not an expert on imputation, you now get the gist. Correcting your data for missing values is a tedious and critical component of these exercises. There doesn’t tend to be one best way and your methods are often judgment calls. If 40% of your data is missing do you go through a similar exercise to what we just saw? Probably not, but it may depend on why the data is missing. The point here is to think about what you are doing in the context of what you are trying to accomplish.</p>
</div>
<div id="discretizing-our-numerical-variables" class="section level4" number="5.2.3.1">
<h4>
<span class="header-section-number">5.2.3.1</span> Discretizing our numerical variables<a class="anchor" aria-label="anchor" href="#discretizing-our-numerical-variables"><i class="fas fa-link"></i></a>
</h4>
<p>Many operations (such as <em>latent class regression</em>) require discreet data. There is some art to this part of the exercise. However, there are several ways to approach it. We’ll do it in a couple of different ways. We’ll start by creating a couple of different data structures that are appropriate for our segmentation methods.</p>
<p>Let’s begin by creating a new data frame to work with. We’ll use data frames and tibbles interchangeably. We haven’t spoken about tibbles. Tibbles are a Wickham construct for working in the tidyverse. They functionally act like data frames, but have some features that generally make them a little friendlier to work with. However certain legacy packages require data frames. This is one of the peculiarities of R that you won’t find in Python. This can also be frustrating.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Create a new dataframe to work with</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_data_discrete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>custID <span class="op">=</span> <span class="va">demo_data</span><span class="op">$</span><span class="va">custID</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="dummy-coding-our-categorical-variables" class="section level4" number="5.2.3.2">
<h4>
<span class="header-section-number">5.2.3.2</span> Dummy coding our categorical variables<a class="anchor" aria-label="anchor" href="#dummy-coding-our-categorical-variables"><i class="fas fa-link"></i></a>
</h4>
<p>Categorical variables have to be treated in a particular way to be useful in many segmentation exercises. To begin, we need to discretize our numerical variables. We’ll do this with a function that we apply over numerical data sets. The following function represents a choice you’ll have to make. How do we determine where and how to break our continuous data into discrete groups. In this case, we use familiar generational marketing groups. The package <em>lubridate</em> <span class="citation">(<a href="references.html#ref-R-lubridate" role="doc-biblioref">Spinu, Grolemund, and Wickham 2021</a>)</span> is used to make working with dates easier. Dates can be incredibly frustrating and along with <em>regular expressions</em><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Regular_expression" class="uri"&gt;https://en.wikipedia.org/wiki/Regular_expression&lt;/a&gt;&lt;/p&gt;'><sup>36</sup></a> are one of the most reviled parts of working with data.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Calculate birth year and assign to a generation</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="va">birthYear</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f_seg_generation_def</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">birth_year</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">birth_year</span> <span class="op">&gt;=</span> <span class="fl">1910</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;=</span> <span class="fl">1924</span><span class="op">)</span><span class="op">{</span><span class="st">'gen_Greatest'</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">birth_year</span> <span class="op">&gt;=</span> <span class="fl">1925</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;=</span> <span class="fl">1945</span><span class="op">)</span><span class="op">{</span><span class="st">'gen_Silent'</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">birth_year</span> <span class="op">&gt;=</span> <span class="fl">1946</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;=</span> <span class="fl">1964</span><span class="op">)</span><span class="op">{</span><span class="st">'gen_Boomer'</span><span class="op">}</span>    </span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">birth_year</span> <span class="op">&gt;=</span> <span class="fl">1965</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;=</span> <span class="fl">1979</span><span class="op">)</span><span class="op">{</span><span class="st">'gen_X'</span><span class="op">}</span>     </span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">birth_year</span> <span class="op">&gt;=</span> <span class="fl">1980</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;=</span> <span class="fl">1994</span><span class="op">)</span><span class="op">{</span><span class="st">'gen_Mill'</span><span class="op">}</span>       </span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">birth_year</span> <span class="op">&gt;=</span> <span class="fl">1995</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;=</span> <span class="fl">2012</span><span class="op">)</span><span class="op">{</span><span class="st">'gen_Y'</span><span class="op">}</span>    </span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">birth_year</span> <span class="op">&gt;=</span> <span class="fl">2013</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;=</span> <span class="fl">2020</span><span class="op">)</span><span class="op">{</span><span class="st">'gen_Alpha'</span><span class="op">}</span>      </span>
<span>  <span class="kw">else</span><span class="op">{</span><span class="st">'Unknown'</span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">demo_data_discrete</span><span class="op">$</span><span class="va">generation</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">birthYear</span>,<span class="va">f_seg_generation_def</span><span class="op">)</span></span></code></pre></div>
<p>Programmers thrive on criticizing this sort of function. There are often algorithmic methods for simplifying this sort of operation. The <em>switch</em> function in R and other languages can sometimes be used. As long as you aren’t dealing with massive data sets, who cares? This is readable and will get the job done.</p>
<p>I tend to find that I prefer to have an individual’s birth year over age. It helps keep the data evergreen. Keep this in mind when you build surveys. Now we have a discrete value representing specific generations.</p>
<p>Distance represents another nuanced problem. How do we select where to create the breaks? Distance can often be approximated using zipcode centroids and the Haversine <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Haversine_formula" class="uri"&gt;https://en.wikipedia.org/wiki/Haversine_formula&lt;/a&gt;&lt;/p&gt;'><sup>37</sup></a> formula.You can also use Google’s APIs to calculate the latitude and longitude based on address and then estimate drive time. This could be important for certain urban or suburban areas.</p>
<p>In our case, we have already calculated the distance. We’ll use quantiles to place 60% of our customers in one of four buckets.</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Assign a discrete value to distance</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">quantile_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">distance</span>,</span>
<span>                          probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>,<span class="fl">.2</span>,<span class="fl">.3</span>,<span class="fl">.4</span>,<span class="fl">.5</span>,<span class="fl">.6</span>,<span class="fl">.7</span>,<span class="fl">.8</span>,<span class="fl">.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f_seg_dist_def</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dist</span>,<span class="va">q</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">dist</span> <span class="op">&lt;=</span> <span class="fl">30.67</span><span class="op">)</span><span class="op">{</span><span class="st">'dist_Primary'</span><span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">dist</span> <span class="op">&gt;</span> <span class="fl">30.67</span> <span class="op">&amp;</span> <span class="va">dist</span> <span class="op">&lt;=</span> <span class="fl">51.23</span><span class="op">)</span><span class="op">{</span><span class="st">'dist_Secondary'</span><span class="op">}</span></span>
<span>      <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">dist</span> <span class="op">&gt;</span> <span class="fl">41.23</span> <span class="op">&amp;</span> <span class="va">dist</span> <span class="op">&lt;=</span> <span class="fl">106.07</span><span class="op">)</span><span class="op">{</span><span class="st">'dist_Tertiary'</span><span class="op">}</span>    </span>
<span>        <span class="kw">else</span><span class="op">{</span><span class="st">'dist_Quaternary'</span><span class="op">}</span>        </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">demo_data_discrete</span><span class="op">$</span><span class="va">marketLoc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">distance</span>,<span class="va">f_seg_dist_def</span><span class="op">)</span></span></code></pre></div>
<p>We can discretize household income in the same way. In this case, we’ll only use three buckets. Keep in mind that the more categories that you have, the more columns you will have in your final data set. it can be problematic if you get too many.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Assign a discrete value to household Income</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">hhIncomeQuantiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">hhIncome</span>,</span>
<span>                              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.25</span>,<span class="fl">.75</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f_seg_hhInc_def</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hhInc</span>, <span class="va">quant</span> <span class="op">=</span> <span class="va">hhIncomeQuantiles</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">hhInc</span> <span class="op">&lt;=</span> <span class="va">hhIncomeQuantiles</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">{</span><span class="st">"income_low"</span><span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">hhInc</span> <span class="op">&gt;=</span> <span class="va">hhIncomeQuantiles</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">{</span><span class="st">"income_high"</span><span class="op">}</span></span>
<span>      <span class="kw">else</span><span class="op">{</span><span class="st">"income_med"</span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">demo_data_discrete</span><span class="op">$</span><span class="va">income</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">demo_data</span><span class="op">$</span><span class="va">hhIncome</span>,<span class="va">f_seg_hhInc_def</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we’ll add these variables to our dataframe.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Add columns to demo_data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_data_discrete</span> <span class="op">&lt;-</span> <span class="va">demo_data_discrete</span>    <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ethnicity <span class="op">=</span> <span class="va">demo_data</span><span class="op">$</span><span class="va">ethnicity</span>,</span>
<span>         married   <span class="op">=</span> <span class="va">demo_data</span><span class="op">$</span><span class="va">maritalStatus</span>,</span>
<span>         gender    <span class="op">=</span> <span class="va">demo_data</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:discretizeaddtoframeheadzz">Table 5.14: </span>discretized data</caption>
<thead><tr class="header">
<th align="center">custID</th>
<th align="center">generation</th>
<th align="center">marketLoc</th>
<th align="center">income</th>
<th align="center">ethnicity</th>
<th align="center">married</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">MBT9G0X70NTI</td>
<td align="center">gen_X</td>
<td align="center">dist_Secondary</td>
<td align="center">income_high</td>
<td align="center">w</td>
<td align="center">m</td>
</tr>
<tr class="even">
<td align="center">HOMV3XQW32LW</td>
<td align="center">gen_Mill</td>
<td align="center">dist_Secondary</td>
<td align="center">income_med</td>
<td align="center">w</td>
<td align="center">s</td>
</tr>
<tr class="odd">
<td align="center">RJ7CCATUH4Q1</td>
<td align="center">gen_Mill</td>
<td align="center">dist_Tertiary</td>
<td align="center">income_med</td>
<td align="center">w</td>
<td align="center">s</td>
</tr>
<tr class="even">
<td align="center">9GZT5Z5AOMKV</td>
<td align="center">gen_X</td>
<td align="center">dist_Primary</td>
<td align="center">income_med</td>
<td align="center">w</td>
<td align="center">m</td>
</tr>
<tr class="odd">
<td align="center">S0Y0Y2454IU2</td>
<td align="center">gen_X</td>
<td align="center">dist_Tertiary</td>
<td align="center">income_high</td>
<td align="center">w</td>
<td align="center">m</td>
</tr>
<tr class="even">
<td align="center">YOZ51B6A2QMB</td>
<td align="center">gen_Mill</td>
<td align="center">dist_Secondary</td>
<td align="center">income_med</td>
<td align="center">h</td>
<td align="center">s</td>
</tr>
</tbody>
</table></div>
<p>Now that we have all discrete variables, we can take our preparation a step further and dummy-code our variables. Once again, there are several ways to do this. The psych package has a function that I tend to use. This is another frustrating thing about R. In Python, unless you implement your own encoder, you will likely always do this the exact same way every time.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Dummy code (One Hot encoding) for model consumption</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">dummy_coded_vars</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">demo_data_discrete</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>,<span class="fl">2</span>, </span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/dummy.code.html">dummy.code</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod_data_discrete</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span><span class="va">dummy_coded_vars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dummy_coded_vars</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">mod_data_discrete</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">demo_data_discrete</span><span class="op">$</span><span class="va">custID</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moddatahead">Table 5.15: </span>Dummy coded data</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">generation.gen_X</th>
<th align="center">generation.gen_Mill</th>
<th align="center">generation.gen_Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">MBT9G0X70NTI</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">HOMV3XQW32LW</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">RJ7CCATUH4Q1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">9GZT5Z5AOMKV</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">S0Y0Y2454IU2</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">YOZ51B6A2QMB</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody>
</table></div>
<p>Now we have a dataframe that consists of only categorical data, we’ll create one that has the mixed numerical and dummy-coded categorical data.</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Combine data frames</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">mod_data_numeric</span> <span class="op">&lt;-</span> <span class="va">demo_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'age'</span>,<span class="st">'distance'</span>,<span class="st">'hhIncome'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mod_data_numeric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span><span class="va">mod_data_numeric</span>,</span>
<span>                                     <span class="va">mod_data_discrete</span><span class="op">[</span>,<span class="fl">13</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moddatanumerichead">Table 5.16: </span>Combined data frame</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">age</th>
<th align="center">distance</th>
<th align="center">hhIncome</th>
<th align="center">ethnicity.w</th>
<th align="center">ethnicity.aa</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">MBT9G0X70NTI</td>
<td align="center">55</td>
<td align="center">48.34</td>
<td align="center">2866</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">HOMV3XQW32LW</td>
<td align="center">30</td>
<td align="center">46.72</td>
<td align="center">2274</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">RJ7CCATUH4Q1</td>
<td align="center">29</td>
<td align="center">65.45</td>
<td align="center">1773</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">9GZT5Z5AOMKV</td>
<td align="center">48</td>
<td align="center">19.28</td>
<td align="center">1951</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">S0Y0Y2454IU2</td>
<td align="center">49</td>
<td align="center">69.20</td>
<td align="center">3244</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">YOZ51B6A2QMB</td>
<td align="center">28</td>
<td align="center">31.13</td>
<td align="center">1638</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
</tbody>
</table></div>
<p>Our new dataframe now mixes our discrete and continuous variables in a format that is consumable by a wide array of machine learning tools. Each column is numeric. We could take this even further, but this example will work for now.</p>
</div>
</div>
<div id="hiearchical-clustering" class="section level3" number="5.2.4">
<h3>
<span class="header-section-number">5.2.4</span> Hiearchical clustering<a class="anchor" aria-label="anchor" href="#hiearchical-clustering"><i class="fas fa-link"></i></a>
</h3>
<p>Hierarchical clustering is seductive because its results are so easily illustrated. However, the drawback here is that for simple models, this technique may tell you what you already know. A more precise explanation would be “The constraint that the structure is hierarchical corresponds to the fact that, although subsets can include one another, they cannot intersect.” <span class="citation">(<a href="references.html#ref-Witten2011" role="doc-biblioref">Ian H. Witten 2011</a>)</span> This technique could also be problematic for larger data sets.</p>
<p>Let’s take a look at an example. We’ll have to start by creating a dissimilarity matrix. We’ll sample of data to deal first.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Prepared data for hierarchical clustering</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/">cluster</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">755</span><span class="op">)</span></span>
<span><span class="va">mod_data_samp</span>     <span class="op">&lt;-</span> <span class="va">mod_data_numeric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">mod_data_samp</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">mod_data_samp</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span><span class="co"># Create dissimilarity matrix</span></span>
<span><span class="va">mod_dist</span> <span class="op">&lt;-</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/daisy.html">daisy</a></span><span class="op">(</span><span class="va">mod_data_samp</span><span class="op">)</span></span></code></pre></div>
<p>We can now use this dissimilarity matrix to cluster our data. Keep in mind that dissimilarity matrices get large fast. Take a look at it and you will understand why. In many cases, this is why sampling data to approximate large data sets is key. Most big data problems are simply small data problems in disguise. In this case we only sampled twenty-five individuals.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Apply heirarchical clustering method</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">mod_HC</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">mod_dist</span>, method <span class="op">=</span> <span class="st">"centroid"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Apply hierarchical clustering method</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_HC</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="05-Segmentation_files/figure-html/hcclustplot-1.png" width="672"></div>
<p>As we can see, there are several groups of fans that tend to cluster together. However, the cuts can tend to happen in predictable ways using this technique. This is a byproduct of the categorical data.</p>
</div>
<div id="latent-class-regression" class="section level3" number="5.2.5">
<h3>
<span class="header-section-number">5.2.5</span> Latent class regression<a class="anchor" aria-label="anchor" href="#latent-class-regression"><i class="fas fa-link"></i></a>
</h3>
<p>Latent class regression is a powerful technique that produces durable clusters. It leverages discrete data, so continuous data will have to be discredited and dummy-coded prior to use. While we’ve already dummy-coded our data, we’ll have to process it one more time so that it accepted by the LCR function. This is another one of the quirks of R. It allows this to happen. In this case we’ll simply make the zeros = 2. We can do this with an apply function and a simple <em>ifelse</em> function.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Latent Class regression</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">mod_data_LC</span>   <span class="op">&lt;-</span> <span class="va">mod_data_discrete</span></span>
<span><span class="va">mod_data_LC</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mod_data_discrete</span>, <span class="fl">2</span>, </span>
<span>                       <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">1</span> ,<span class="fl">1</span> ,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lcr22">Table 5.17: </span>Data coded for LCR function</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">generation.gen_X</th>
<th align="center">generation.gen_Mill</th>
<th align="center">generation.gen_Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">MBT9G0X70NTI</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="left">HOMV3XQW32LW</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="left">RJ7CCATUH4Q1</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="left">9GZT5Z5AOMKV</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="left">S0Y0Y2454IU2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="left">YOZ51B6A2QMB</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
</tbody>
</table></div>
<p>A useful trick is to try to simplify the function that feeds the clustering function. It will make the function easier to read as you add parameters to it.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Latent Class regression formula</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">format</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mod_data_LC</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">mod_data_LC</span>,</span>
<span>       <span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">generation.gen_X</span>,<span class="va">generation.gen_Mill</span>,</span>
<span>             <span class="va">generation.gen_Boomer</span>,<span class="va">generation.gen_Y</span>,</span>
<span>             <span class="va">generation.gen_Silent</span>,<span class="va">marketLoc.dist_Quaternary</span>,</span>
<span>             <span class="va">marketLoc.dist_Tertiary</span>,<span class="va">marketLoc.dist_Secondary</span>,</span>
<span>             <span class="va">marketLoc.dist_Primary</span>,<span class="va">income.income_med</span>,</span>
<span>             <span class="va">income.income_low</span>,<span class="va">income.income_high</span>,</span>
<span>             <span class="va">ethnicity.w</span>,<span class="va">ethnicity.aa</span>,<span class="va">ethnicity.h</span>,</span>
<span>             <span class="va">ethnicity.a</span>,<span class="va">married.m</span>,<span class="va">married.s</span>,<span class="va">gender.f</span>,</span>
<span>             <span class="va">gender.m</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We are going to choose five classes to include in this data. While there are formal methods for determining the number of classes to include, keep in mind that for these classes to be useful and understandable, you will probably have to abstract them into relatively few groups. This can also be problematic since the behaviors exhibited by the group can become diffuse.</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Latent Class regression</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dlinzer/poLCA">poLCA</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">363</span><span class="op">)</span></span>
<span><span class="va">seg_LCR_5</span> <span class="op">&lt;-</span> <span class="fu">poLCA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/poLCA/man/poLCA.html">poLCA</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">mod_data_LC</span>, </span>
<span>                          nclass <span class="op">=</span> <span class="fl">5</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>You can also save your model to import and apply back to new data in the future.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">seg_LCR_5</span>, file<span class="op">=</span><span class="st">"CH5_LCR_5_Model.Rdata"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can look to see how many groups were created by our machine-learning algorithm.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Evaluating the results</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">seg_LCR_5</span><span class="op">$</span><span class="va">predclass</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lcrtablesix">Table 5.18: </span>Frequency table of segments</caption>
<thead><tr class="header">
<th align="center">Var1</th>
<th align="center">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">29327</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">57541</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">56972</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">42906</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">9281</td>
</tr>
</tbody>
</table></div>
<p>It looks like our groups have a fairly large range. The smallest group contains over 10,000 people while the largest one contains over 56,000 individuals.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Attaching to the data frame</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">mod_results</span>          <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mod_data_LC</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_results</span><span class="op">$</span><span class="va">custID</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">mod_data_LC</span><span class="op">)</span></span>
<span><span class="va">mod_results</span><span class="op">$</span><span class="va">lcrClass</span> <span class="op">&lt;-</span> <span class="va">seg_LCR_5</span><span class="op">$</span><span class="va">predclass</span></span></code></pre></div>
<p>We can now create a list of ids with the class to apply to our original data set.</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># View segments</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mod_results</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lcrmodresults">Table 5.19: </span>LC model results</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">female</th>
<th align="left">male</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">custID</td>
<td align="left">MBT9G0X70NTI</td>
<td align="left">HOMV3XQW32LW</td>
</tr>
<tr class="even">
<td align="left">lcrClass</td>
<td align="left">2</td>
<td align="left">4</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Attaching to the data frame</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_data_segments</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">demo_data</span>,<span class="va">mod_results</span>, by <span class="op">=</span> <span class="st">"custID"</span><span class="op">)</span></span></code></pre></div>
<p>Once they are joined, you can create some interesting crosstabs to look for differences between the groups.</p>
<p>In general, distance is fairly similar with one group being slightly further away on average.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Distance cross tab</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">demo_seg_distance</span> <span class="op">&lt;-</span> <span class="va">demo_data_segments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">lcrClass</span><span class="op">)</span>                    <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avgDist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>,</span>
<span>            medDist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span>                  </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lcrdistcross">Table 5.20: </span>Distance by segment</caption>
<thead><tr class="header">
<th align="center">lcrClass</th>
<th align="center">avgDist</th>
<th align="center">medDist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">109.8787</td>
<td align="center">66.65</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">110.5445</td>
<td align="center">66.65</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">110.1359</td>
<td align="center">66.29</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">107.3030</td>
<td align="center">64.00</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">118.3308</td>
<td align="center">78.02</td>
</tr>
</tbody>
</table></div>
<p>Age is much more interesting. There are three distinct groups that manifest when we arrange by our latent classes.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Age cross tab</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_data_segments</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">demo_data_segments</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">demo_seg_age</span> <span class="op">&lt;-</span> <span class="va">demo_data_segments</span>             <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">lcrClass</span><span class="op">)</span>             <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avgAge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>                          medAge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span>                    </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lcragecross">Table 5.21: </span>Age by segment</caption>
<thead><tr class="header">
<th align="center">lcrClass</th>
<th align="center">avgAge</th>
<th align="center">medAge</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">26.61309</td>
<td align="center">26</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">51.99592</td>
<td align="center">52</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">52.04932</td>
<td align="center">52</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">31.68916</td>
<td align="center">31</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">31.68118</td>
<td align="center">31</td>
</tr>
</tbody>
</table></div>
<p>Household income is also well differentiated with three distinct groups.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Household income cross tab</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_seg_HHI</span> <span class="op">&lt;-</span> <span class="va">demo_data_segments</span>                        <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">lcrClass</span><span class="op">)</span>                   <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avgHHI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hhIncome</span><span class="op">)</span>,</span>
<span>                               medHHI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">hhIncome</span><span class="op">)</span><span class="op">)</span></span>
<span>                    </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lcrhhicross">Table 5.22: </span>HHI by segment</caption>
<thead><tr class="header">
<th align="center">lcrClass</th>
<th align="center">avgHHI</th>
<th align="center">medHHI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1350.691</td>
<td align="center">1117.0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2429.860</td>
<td align="center">2622.0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2406.015</td>
<td align="center">2629.5</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1512.979</td>
<td align="center">1433.0</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1516.207</td>
<td align="center">1431.0</td>
</tr>
</tbody>
</table></div>
<p>Gender has two groups that are only male and female and three groups that are evenly split.</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Gender cross tab</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_seg_gender</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">demo_data_segments</span>         <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">lcrClass</span><span class="op">)</span>         <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span>              <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">gender</span>, </span>
<span>                     values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>                     </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lcrgencross">Table 5.23: </span>Gender by segment</caption>
<thead><tr class="header">
<th align="center">lcrClass</th>
<th align="center">f</th>
<th align="center">m</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">14695</td>
<td align="center">14632</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">NA</td>
<td align="center">57541</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">56972</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">21552</td>
<td align="center">21354</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">4628</td>
<td align="center">4653</td>
</tr>
</tbody>
</table></div>
<p>Ethnicity appears to be fairly well distributed across three groups.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Ethnicity tab</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">demo_seg_ethnicity</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">demo_data_segments</span>    <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">lcrClass</span><span class="op">)</span>    <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">ethnicity</span><span class="op">)</span>      <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from  <span class="op">=</span> <span class="va">ethnicity</span>, </span>
<span>                     values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>                    </span></code></pre></div>
<p>This one is a little more complex. We can use a heat map to visualize the relationships. We will exponentially diminish the differences between the colors by using the log function int the fill argument. This is a useful technique. Keep it in mind. Logarithms are great at compressing data that isn’t easy to visualize because of the distriburion.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co">#  Visualize ethnicity</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">demo_seg_ethnicity_l</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">demo_data_segments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">lcrClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">ethnicity</span><span class="op">)</span>      </span>
<span></span>
<span><span class="va">demo_seg_ethnicity_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">demo_seg_ethnicity_l</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'\n Ethnicity'</span><span class="op">)</span></span>
<span><span class="va">y_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Class \n'</span><span class="op">)</span></span>
<span><span class="va">title</span>   <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Ethnicity by class'</span><span class="op">)</span></span>
<span><span class="va">tile_segment</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data   <span class="op">=</span> <span class="va">demo_seg_ethnicity_l</span>, </span>
<span>                              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x    <span class="op">=</span> <span class="va">ethnicity</span>,</span>
<span>                                  y    <span class="op">=</span> <span class="va">lcrClass</span>,</span>
<span>                                  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>               <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span>                                                   <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"white"</span>, high<span class="op">=</span><span class="st">"dodgerblue"</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">'log(Fans)'</span>,label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">x_label</span><span class="op">)</span>                                                 <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">y_label</span><span class="op">)</span>                                                 <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>                                                <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_ethnic_table.png" width="100%"></div>
<p>One segment is made up entirely of white individuals while one segment has no white individuals. The other segments are split proportionally across each ethnic group. So what do we do now? Do we have any reason to believe that these groups represent segments of individuals? Do they even represent market structure. You are far from finished. Do some of these groups spend more money on average? Do they respond to advertising in different ways? You’ll want to answer these questions. Another way to approach this problem is to segment people by their measurable behaviors and then look for look-alike groups. This is probably the most common way to leverage this sort of analysis.</p>
<p>We will demonstrate one more segmentation approach and combine it with our previous analysis to create psychograhic segments.</p>
</div>
</div>
<div id="a-benefits-sought-approach-to-segmentation" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> A benefits sought approach to segmentation<a class="anchor" aria-label="anchor" href="#a-benefits-sought-approach-to-segmentation"><i class="fas fa-link"></i></a>
</h2>
<p>Behavioral segmentation can take many forms. We’ll focus on activities that fans may consider when attending a game. Taking a benefits-sought approach to segmentation is interesting because it gives you specific insight into how you might position marketing offers to a specific group. The downside is that discoverability is reduced.</p>
<p>We’ll link both forms to build psychographic profiles. This can go much deeper. For instance, you can ask many more questions pertaining to all sorts of activities. We’ll cover some of this in our chapter on research, chapter <a href="chapter9.html#chapter9">9</a>.</p>
</div>
<div id="factoranalysis" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Using a factor analysis to segment<a class="anchor" aria-label="anchor" href="#factoranalysis"><i class="fas fa-link"></i></a>
</h2>
<p>A factor analysis is a data reduction technique similar to a principle components analysis. We’ll use it in a slightly different way to compress stated behaviors and use the patterns to create specific archetypes.</p>
<p>We can load some survey data using the <em>fa_survey_data</em> data set in FOSBAAS.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># access the survey data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">survey</span> <span class="op">&lt;-</span> <span class="fu">FOSBAAS</span><span class="fu">::</span><span class="va">fa_survey_data</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:fab">Table 5.24: </span>Survey data</caption>
<colgroup>
<col width="34%">
<col width="13%">
<col width="11%">
<col width="15%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="center">ReasonForAttending</th>
<th align="center">Socialize</th>
<th align="center">Tailgate</th>
<th align="center">TakeSelfies</th>
<th align="center">PostToSocialMedia</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Special Game</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">Support the Team</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">Celebrate a birthday</td>
<td align="center">9</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">Visit the park</td>
<td align="center">8</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">Celebrate an anniversary</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">Company outing</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">6</td>
<td align="center">0</td>
</tr>
</tbody>
</table></div>
<p>This data set is based on asking individuals what they like to do at the ballpark. There is a list of predefined activities and fans are asked to rank from 0 to 10. Fans were also asked why they attended the game.</p>
<p>This data wasn’t created with a person in mind. We can simply assign <em>customer_ids</em> to this data set to simulate real people having taken the survey. We’ll also need to process the data before we perform our factor analysis. We will use the <em>scale</em> function to normalize the data. We haven’t discussed this yet, but it can be important for mixed data sets. Make sure that the data is placed in a dataframe instead of a tibble.</p>
<p>Now that our data is prepared for analysis, we need to consider how many factors to create. There is a formulaic way to determine the number of factors. we’ll use <em>nScree</em> function in the nFactors <span class="citation">(<a href="references.html#ref-R-nFactors" role="doc-biblioref">Raiche and Magis 2020</a>)</span> package to get an idea of how many factors are appropriate. There are ways to visualize this data. Try the <em>eigen(cor(survey_sc))</em> function to access the eigenvalues.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># access the survey data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">nFacts</span> <span class="op">&lt;-</span> <span class="fu">nFactors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nFactors/man/nScree.html">nScree</a></span><span class="op">(</span><span class="va">survey_sc</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:fae">Table 5.25: </span>Number of Factors</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Factors</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">noc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">naf</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">nparallel</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">nkaiser</td>
<td align="right">5</td>
</tr>
</tbody>
</table></div>
<p>Now that we have an idea of how many factors are appropriate, we can run our factor analysis. We’ll use the GPArotation package <span class="citation">(<a href="references.html#ref-R-GPArotation" role="doc-biblioref">Bernaards and Jennrich 2014</a>)</span> to add the rotation argument to the <em>factanal</em> function from the stats <span class="citation">(<a href="references.html#ref-R-stats" role="doc-biblioref">2021</a>)</span> package. This will help us visualize the data.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># run a factor analysis</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://optimizer.r-forge.r-project.org/GPArotation_www/">GPArotation</a></span><span class="op">)</span></span>
<span><span class="va">survey_sc_ob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/factanal.html">factanal</a></span><span class="op">(</span><span class="va">survey_sc</span>,</span>
<span>                         factors  <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                         rotation <span class="op">=</span> <span class="st">"oblimin"</span>,</span>
<span>                         scores   <span class="op">=</span> <span class="st">"Bartlett"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll have to restructure the data to prepare it for visualization.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Restructure the data</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">survey_sc_ob_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">survey_sc_ob</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">survey_sc_ob_scores</span><span class="op">$</span><span class="va">Reason</span> <span class="op">&lt;-</span> <span class="va">survey</span><span class="op">$</span><span class="va">ReasonForAttending</span></span>
<span></span>
<span><span class="va">fa_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">unclass</a></span><span class="op">(</span><span class="va">survey_sc_ob</span><span class="op">$</span><span class="va">loadings</span><span class="op">)</span></span>
<span><span class="va">fa_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">fa_data</span><span class="op">)</span></span>
<span><span class="va">fa_data</span><span class="op">$</span><span class="va">Selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fa_data</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">fa_data_p</span> <span class="op">&lt;-</span>  </span>
<span>  <span class="va">fa_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">Selection</span>, </span>
<span>                                   names_to  <span class="op">=</span> <span class="st">"Factor"</span>, </span>
<span>                                   values_to <span class="op">=</span> <span class="st">"Loading"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fa_data_p</span><span class="op">$</span><span class="va">Order</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">fa_data_p</span><span class="op">$</span><span class="va">Selection</span>,<span class="va">fa_data_p</span><span class="op">$</span><span class="va">Loading</span>,<span class="va">sum</span><span class="op">)</span></span></code></pre></div>
<p>Now that are data is processed into a format we can graph, we can take a look at it.</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Visualize the factors</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">factor_table</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fa_data_p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Factor</span>, <span class="va">Order</span><span class="op">)</span><span class="op">)</span>                       <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Loading</span><span class="op">)</span><span class="op">)</span>                            <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">Loading</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,color<span class="op">=</span><span class="st">'grey40'</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low      <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>                      high     <span class="op">=</span> <span class="st">"dodgerblue"</span>, </span>
<span>                      space    <span class="op">=</span> <span class="st">"Lab"</span>,</span>
<span>                      na.value <span class="op">=</span> <span class="st">"grey50"</span>, </span>
<span>                      guide    <span class="op">=</span> <span class="st">"colourbar"</span><span class="op">)</span>               <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'\n Factor'</span><span class="op">)</span>                                         <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">'Activity\n'</span><span class="op">)</span>                                        <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'What do fans do at games? \n'</span><span class="op">)</span>                   <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span>                                          <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>                             <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   size <span class="op">=</span> <span class="fl">8</span>, vjust <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   color <span class="op">=</span> <span class="st">"grey10"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_factor_table.png" width="100%"></div>
<p>We can see that certain activities tend to group into the factors. What do you do with this data? First of all, we need to name these groups so that they are approachable. This is an art. Let’s give it a terrible try:</p>
<ol style="list-style-type: decimal">
<li>Factor 1: Activities tend to be oriented toward the game itself. Let’s call them <strong>Avid fans</strong>. Creative.</li>
<li>Factor 2: Tailgating, posting to social media. <strong>Socializers</strong>. This group also tends to have an affinity for children’s activities.</li>
<li>Factor 3. Drink beer, sample food, Eat park food. <strong>Foodies</strong>.</li>
<li>Factor 4: Seems to be more interested in being at the park. We’ll need to go deeper here. <strong>Parkies</strong>.</li>
<li>Factor 5: Doesn’t really have distinct groupings. <strong>Strangers</strong>
</li>
</ol>
<p>Consultants with marketing backgrounds will begin crafting stories about these groups. Supplemental analysis is necessary to get more granular behavioral profiles. We won’t take this fake exercise that far. You get the point.</p>
<p>One of the problems with using this sort of analysis is that it is impossible to cast these segments across groups that have not taken the survey. Additionally, someone could belong to different segments on different days. Perhaps a father brings his children to a game one day and then goes out with some friends on another. <em>Belonginess</em> can be mutable. However, if you have richer data on the data sample you might be able to predict their segment. You might also be able to create richer profiles by utilizing the demographic segments created earlier in this chapter. Let’s begin by building a simple model to see if our factors can be used to predict the reason someone came to the game. Then we will combine some of this data and see what we can find.</p>
<p>We’ll use a function from the <em>nnet</em> package and over-fit the model. We aren’t going to be rigorous here because we are really just looking at this out of curiosity. We’ll use the <em>multinom</em> function from the nnet <span class="citation">(<a href="references.html#ref-R-nnet" role="doc-biblioref">Ripley 2022</a>)</span> package to try to predict the classes.</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># predict classes</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span></span>
<span><span class="va">mod_glm</span> <span class="op">&lt;-</span>   <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span><span class="op">(</span><span class="va">Reason</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">survey_sc_ob_scores</span>,</span>
<span>                            linout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # weights:  98 (78 variable)</span></span>
<span><span class="co">#&gt; initial  value 26390.573296 </span></span>
<span><span class="co">#&gt; iter  10 value 26368.581604</span></span>
<span><span class="co">#&gt; iter  20 value 26367.453867</span></span>
<span><span class="co">#&gt; iter  30 value 26362.202858</span></span>
<span><span class="co">#&gt; iter  40 value 26361.592507</span></span>
<span><span class="co">#&gt; iter  50 value 26360.892606</span></span>
<span><span class="co">#&gt; final  value 26360.870907 </span></span>
<span><span class="co">#&gt; converged</span></span>
<span></span>
<span><span class="va">pred_survey_sc_ob_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_glm</span> , </span>
<span>                            newdata<span class="op">=</span><span class="va">survey_sc_ob_scores</span>,</span>
<span>                            type<span class="op">=</span><span class="st">'class'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tile_data</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">survey_sc_ob_scores</span><span class="op">$</span><span class="va">Reason</span>,</span>
<span>                    <span class="va">pred_survey_sc_ob_scores</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Visualize the factors</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'\n Actual response'</span><span class="op">)</span></span>
<span><span class="va">y_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Attend predict \n'</span><span class="op">)</span></span>
<span><span class="va">title</span>   <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Prediction of attendance reason'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tile_class</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hex_data</span>, </span>
<span>                              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x    <span class="op">=</span> <span class="va">Var1</span>,</span>
<span>                                  y    <span class="op">=</span> <span class="va">pred_survey_sc_ob_scores</span>,</span>
<span>                                  fill <span class="op">=</span> <span class="va">Freq</span><span class="op">)</span><span class="op">)</span>        <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span>                               <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"dodgerblue"</span>, high <span class="op">=</span> <span class="st">"coral"</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">'Count'</span>,label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>   <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">x_label</span><span class="op">)</span>                                               <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">y_label</span><span class="op">)</span>                                               <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>                                              <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span>                                            <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, </span>
<span>                                   size <span class="op">=</span> <span class="fl">8</span>, vjust <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   color <span class="op">=</span> <span class="st">"grey10"</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   size <span class="op">=</span> <span class="fl">8</span>, vjust <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   color <span class="op">=</span> <span class="st">"grey10"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_reason_table.png" width="100%"></div>
<p>Not surprisingly, you can’t. However, the reasons were created completely randomly, so I wouldn’t really expect to see good predictions here. If you could predict the reasons, I would expect to see a nice 45 degree color band through the middle of the graph. What if you had a terrible result like this in real life? You would have to go back and evaluate the data in another way. This would be a dead-end. This happens frequently.</p>
<div id="casting-segments-onto-other-groups" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Casting segments onto other groups<a class="anchor" aria-label="anchor" href="#casting-segments-onto-other-groups"><i class="fas fa-link"></i></a>
</h3>
<p>Can we use our demographic factors to estimate someone’s <em>factor</em> group? If we could, it would be easy to cast these segments onto broader groups of people. Let’s assign our survey respondents to individuals in our customer table</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Apply classes to individuals</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">demo_data_segments</span><span class="op">$</span><span class="va">custID</span>,<span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">survey_sc_ob_scores</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">survey_sc_ob_scores</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">survey_sc_ob_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>                                        ties.method<span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">survey_sc_ob_scores</span><span class="op">$</span><span class="va">custID</span> <span class="op">&lt;-</span> <span class="va">ids</span></span>
<span><span class="va">combined_classes</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">demo_data_segments</span>,</span>
<span>                                     <span class="va">survey_sc_ob_scores</span>,</span>
<span>                                     by<span class="op">=</span><span class="st">"custID"</span><span class="op">)</span>         <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">combined_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">combined_classes</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have combined these analyses we can look for patterns within the data. First, let’s recode some of the data so that it is more approachable. Let’s use the <em>switch</em> function. The switch function is great, but not every language has it. Thanks R.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># recode the factors and classes</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">combined_classes</span><span class="op">$</span><span class="va">f_seg_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">combined_classes</span><span class="op">$</span><span class="va">Class</span>, </span>
<span>                 <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"Factor1"</span> <span class="op">=</span> <span class="st">"Avid fan"</span>,</span>
<span>                                      <span class="st">"Factor2"</span> <span class="op">=</span> <span class="st">"Socializers"</span>,</span>
<span>                                      <span class="st">"Factor3"</span> <span class="op">=</span> <span class="st">"Foodies"</span>,</span>
<span>                                      <span class="st">"Factor4"</span> <span class="op">=</span> <span class="st">"Parkies"</span>,</span>
<span>                                      <span class="st">"Factor5"</span> <span class="op">=</span> <span class="st">"Strangers"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_classes</span><span class="op">$</span><span class="va">d_seg_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">combined_classes</span><span class="op">$</span><span class="va">lcrClass</span>, </span>
<span>                 <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">'1'</span> <span class="op">=</span> <span class="st">"Young and Broke"</span>,</span>
<span>                                      <span class="st">'2'</span> <span class="op">=</span> <span class="st">"Marty Male"</span>,</span>
<span>                                      <span class="st">'3'</span> <span class="op">=</span> <span class="st">"Fionna Female"</span>,</span>
<span>                                      <span class="st">'4'</span> <span class="op">=</span> <span class="st">"Diffuse Diane"</span>,</span>
<span>                                      <span class="st">'5'</span> <span class="op">=</span> <span class="st">"Nearby Ned"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we are ready to take a look at our profiles in a slightly more sophisticated way.</p>
</div>
</div>
<div id="psychographic-segmentation" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Psychographic segmentation<a class="anchor" aria-label="anchor" href="#psychographic-segmentation"><i class="fas fa-link"></i></a>
</h2>
<p>Psychographic augmentations tend to be more abstract, although they appear to simplify a combination of behavioral and demographic schemes. You see these schemes often. Segments that have alliterative names such as “Jets fan Jeff” or “Torpid Tina.” We can use our behavioral and demographic segmentation schemes to build psychographic schemes.</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Visualize the results</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="va">combined_classes</span>                <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">f_seg_name</span>,<span class="va">d_seg_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>      </span>
<span></span>
<span><span class="va">x_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'\n Factor Segments'</span><span class="op">)</span></span>
<span><span class="va">y_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Demographic Segment \n'</span><span class="op">)</span></span>
<span><span class="va">title</span>   <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Segment Comparrison'</span><span class="op">)</span></span>
<span><span class="va">tile_segment</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cc</span>, </span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">f_seg_name</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">d_seg_name</span>,</span>
<span>                      fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span>                              <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span>                                                 <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"white"</span>, high<span class="op">=</span><span class="st">"dodgerblue"</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">'Count'</span>,label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">)</span>   <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">x_label</span><span class="op">)</span>                                               <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">y_label</span><span class="op">)</span>                                               <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>                                              <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span>                                            <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   size <span class="op">=</span> <span class="fl">8</span>, vjust <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   color <span class="op">=</span> <span class="st">"grey10"</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   size <span class="op">=</span> <span class="fl">8</span>, vjust <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   color <span class="op">=</span> <span class="st">"grey10"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_tile_segment.png" width="100%"></div>
<p>We can see that our demographic segments and factor segments cluster into specific groups. We can now analyze these groups to create specific psychographic profiles.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Scale the results and average</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">combined_classes</span><span class="op">$</span><span class="va">age_s</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">combined_classes</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">combined_classes</span><span class="op">$</span><span class="va">distance_s</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">combined_classes</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">combined_classes</span>                <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">f_seg_name</span>,<span class="va">d_seg_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age_s</span><span class="op">)</span>, </span>
<span>  distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">distance_s</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Now we can take a look at some of the differences between these groups. This data is contrived, but there are some interesting insights we can extract from it.</p>
<ol style="list-style-type: decimal">
<li>The factored segments don’t seem to be influenced by age or distance.</li>
<li>Clusters are well differentiated on distance and age.</li>
</ol>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="co"># Observe differences between the segments</span></span>
<span><span class="co">#-----------------------------------------------------------------</span></span>
<span><span class="va">x_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'\n Scaled Avg Age'</span><span class="op">)</span></span>
<span><span class="va">y_label</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Scaled Avg Distance \n'</span><span class="op">)</span></span>
<span><span class="va">title</span>    <span class="op">&lt;-</span> <span class="op">(</span><span class="st">'Segments by distance and age'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">point_segment</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data      <span class="op">=</span> <span class="va">cc</span>, </span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x     <span class="op">=</span> <span class="va">age</span>,</span>
<span>                      y     <span class="op">=</span> <span class="va">distance</span>,</span>
<span>                      color <span class="op">=</span> <span class="va">f_seg_name</span>,</span>
<span>                      shape <span class="op">=</span> <span class="va">d_seg_name</span><span class="op">)</span><span class="op">)</span>                <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>                                    <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette</span><span class="op">)</span>                    <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">cc</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>   <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">cc</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>        <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">x_label</span><span class="op">)</span>                                           <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">y_label</span><span class="op">)</span>                                           <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>                                          <span class="op">+</span></span>
<span>  <span class="va">graphics_theme_1</span></span></code></pre></div>
<div class="inline-figure"><img src="images/ch5_point_segment.png" width="100%"></div>
<p>We can use this sort of analysis to produce psychographic profiles. In this case, we can say that our all male and female segments tend to index older than our other segments and live an average distance away from the park. Our <em>Young and Broke</em> segment tends to live nearby. We gave <em>Nearby Ned</em> and ironic name since he tends to live the furthest from the park.</p>
<p>Once again, we are just getting started. This example was produced to demonstrate how tedious segmentation can be. A full analysis would be much more exhausting, but repetitive. We covered the basic steps.</p>
</div>
<div id="other-segmentation-methods" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Other segmentation methods<a class="anchor" aria-label="anchor" href="#other-segmentation-methods"><i class="fas fa-link"></i></a>
</h2>
<p>There are hundreds of methods to segment data. As a general rule, start with the simplest method and work from there. That means using one rule to do it. Think Males and Females. There are many other tools that you could use:</p>
<ul>
<li>K-means clustering</li>
<li>KNN</li>
<li>Expectation maximization</li>
<li>simple schemes</li>
</ul>
<p>No one approach is best. Nate Silver describes the Hedgehog and the Fox in his book “The Signal and the Noise.” <span class="citation">(<a href="references.html#ref-Silver2012" role="doc-biblioref">Silver 2012</a>)</span> In the case of forecasting, you will want to be the fox. You’ll need to combine practical knowledge with an analytic process. A purely numerical approach is unlikely to yield the best results.</p>
</div>
<div id="key-concepts-and-chapter-summary-4" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Key concepts and chapter summary<a class="anchor" aria-label="anchor" href="#key-concepts-and-chapter-summary-4"><i class="fas fa-link"></i></a>
</h2>
<p>Segmenting data is an art and a science. It is also frustrating, repetitive, and difficult. We didn’t cover simple segmentation schemes, such as age ranges or generations. However, this is a good place to typically start. We covered a lot of material in this chapter and tried to hit many of the high marks with tangible examples. We covered:</p>
<ul>
<li>Data exploration for a demographic approach to segmentation</li>
<li>Data preparation and imputation</li>
<li>An hierarchical approach to segmentation</li>
<li>Segmentation schemes using latent class regression and demographics</li>
<li>A benefits sought approach utilizing a factor analysis</li>
<li>Combining schemes to build psychographic profiles</li>
</ul>
<p>There are lots of ways to segment customers or potential customers and you can be creative here. The key is to uncover something beyond market structure. You are looking for exploitable differences between groups that help you spend limited marketing dollars more efficiently.</p>
<ul>
<li>While demographic segmentation has its merits, it may not be of much use to you. It is simply the easiest place to typically start.</li>
<li>Preparing your data for analysis is a tedious task better suited to someone besides you. This part of the project will be the most time consuming. It bears heavily on your outcome get it correct.</li>
<li>Hierarchical approaches to segmentation have utility in some cases, but can often tell you what you already know.</li>
<li>Latent class regression tends to produce durable segments and is a good second-step after looking at simple segmentation schemes.</li>
<li>Benefits-sought approaches to segmentation often have good utility, but are not as discoverable as other methods. A factor analysis is a good method to simplify complex data sets.</li>
<li>You can ensemble these methods to create richer profiles.</li>
</ul>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chapter4.html"><span class="header-section-number">4</span> Structuring analytics projects</a></div>
<div class="next"><a href="chapter6.html"><span class="header-section-number">6</span> Forcasting Sales and Setting Prices</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter5"><span class="header-section-number">5</span> Segmentation</a></li>
<li><a class="nav-link" href="#building-a-segmentation-scheme"><span class="header-section-number">5.1</span> Building a segmentation scheme</a></li>
<li>
<a class="nav-link" href="#demographic-segmentation"><span class="header-section-number">5.2</span> Demographic segmentation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#exploring-the-demographic-data-set"><span class="header-section-number">5.2.1</span> Exploring the demographic data set</a></li>
<li><a class="nav-link" href="#preparing-the-data-for-modeling"><span class="header-section-number">5.2.2</span> Preparing the data for modeling</a></li>
<li><a class="nav-link" href="#dealing-with-missing-data"><span class="header-section-number">5.2.3</span> Dealing with missing data</a></li>
<li><a class="nav-link" href="#hiearchical-clustering"><span class="header-section-number">5.2.4</span> Hiearchical clustering</a></li>
<li><a class="nav-link" href="#latent-class-regression"><span class="header-section-number">5.2.5</span> Latent class regression</a></li>
</ul>
</li>
<li><a class="nav-link" href="#a-benefits-sought-approach-to-segmentation"><span class="header-section-number">5.3</span> A benefits sought approach to segmentation</a></li>
<li>
<a class="nav-link" href="#factoranalysis"><span class="header-section-number">5.4</span> Using a factor analysis to segment</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#casting-segments-onto-other-groups"><span class="header-section-number">5.4.1</span> Casting segments onto other groups</a></li></ul>
</li>
<li><a class="nav-link" href="#psychographic-segmentation"><span class="header-section-number">5.5</span> Psychographic segmentation</a></li>
<li><a class="nav-link" href="#other-segmentation-methods"><span class="header-section-number">5.6</span> Other segmentation methods</a></li>
<li><a class="nav-link" href="#key-concepts-and-chapter-summary-4"><span class="header-section-number">5.7</span> Key concepts and chapter summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/Justin-Watkins/FOSBAAS_web.git/blob/master/05-Segmentation.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/Justin-Watkins/FOSBAAS_web.git/edit/master/05-Segmentation.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentals of Sports Business Analytics and Strategy</strong>" was written by Justin Watkins. It was last built on 2022-12-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
